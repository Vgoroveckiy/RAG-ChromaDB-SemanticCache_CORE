%% Детализированная блок-схема workflow системы
graph TD
    %% Инициализация системы
    A[Запуск системы] --> B[Создание VectorDatabase]
    B --> C[Загрузка/создание ChromaDB]
    C --> D[Инициализация EmbeddingManager]
    D --> E[Загрузка модели эмбеддингов]
    E --> F[Инициализация LLM]
    F --> G[Создание цепочек обработки]
    G --> H[Индексация документов]
    
    %% Процесс индексации
    H --> I[Обход директории документов]
    I --> J{Поддерживаемый формат?}
    J -->|Да| K[Проверка хэша и времени изменения]
    J -->|Нет| L[Пропуск файла]
    K --> M{Файл изменён?}
    M -->|Да| N[Парсинг документа]
    M -->|Нет| O[Использование существующего индекса]
    N --> P[Определение типа документа]
    P --> Q[Разбиение на чанки]
    Q --> R[Генерация метаданных]
    R --> S[Обновление векторной БД]
    S --> T[Очистка удалённых файлов]
    
    %% Обработка запроса
    U[Пользовательский запрос] --> V[RAGSystem]
    V --> W[Проверка семантического кэша]
    W -->|Найдено| X[Возврат кэшированного ответа]
    W -->|Не найдено| Y[Поиск в векторной БД]
    Y --> Z[Получение релевантных чанков]
    Z --> AA[Формирование промта по типу документа]
    AA --> AB[Генерация ответа LLM]
    AB --> AC[Сохранение в кэш]
    AC --> X
    
    %% Управление данными
    AD[Очистка БД] --> AE[Удаление индексов]
    AE --> AF[Пересоздание БД]
    AG[Очистка кэша] --> AH[Удаление устаревших записей]
    AI[Переиндексация] --> AJ[Принудительное обновление]
    
    %% Связи между компонентами
    T --> I
    X --> U
    AJ --> H
